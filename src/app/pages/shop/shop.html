<div class="min-h-screen bg-white">

  <div class="sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-100 lg:hidden">
    <div class="flex justify-between items-center px-6 py-4">
      <span class="text-[10px] uppercase tracking-[0.3em] font-bold text-gray-900">Collection ({{products.length}})</span>
      <button (click)="toggleFilter()" class="flex items-center gap-2 text-[10px] uppercase tracking-[0.2em] font-bold">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 4.5h18m-18 7.5h18m-18 7.5h18" />
        </svg>
        Filter
      </button>
    </div>
  </div>

  <div class="max-w-[1600px] mx-auto px-4 md:px-12 py-8 md:py-16">
    <div class="flex flex-col lg:flex-row gap-12">

      <aside class="hidden lg:block w-64 flex-shrink-0">
        <div class="sticky top-32 space-y-10">
          <div>
            <h1 class="text-3xl font-light uppercase tracking-widest font-khmer-body mb-8">Shop All</h1>
            <h4 class="text-[10px] uppercase tracking-[0.3em] text-gray-400 mb-6 font-bold">Categories</h4>
            <ul class="space-y-4">
              @for (cat of categories; track cat) {
                <li class="text-[11px] uppercase tracking-widest cursor-pointer hover:text-gray-400 transition-colors">
                  {{ cat }}
                </li>
              }
            </ul>
          </div>
        </div>
      </aside>

      <main class="flex-grow">
        <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-x-3 md:gap-x-10 gap-y-10 md:gap-y-20">
          @for (product of products; track product.id) {
            <div class="group cursor-pointer flex flex-col" [routerLink]="['/product', product.id]">

              <div class="relative aspect-[3/4] overflow-hidden bg-gray-50 mb-4">
                <img [src]="product.imageUrl"
                     class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105"
                     (error)="handleImageError($event)">

                @if (product.isNew) {
                  <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm px-2 py-1">
                    <span class="text-[8px] uppercase tracking-widest font-bold">New</span>
                  </div>
                }

                <div class="hidden lg:flex absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity items-end p-4">
                  <button class="w-full bg-white py-3 text-[10px] uppercase tracking-widest font-bold hover:bg-black hover:text-white transition-colors">
                    Quick Add
                  </button>
                </div>
              </div>

              <div class="space-y-1 px-1">
                <div class="flex flex-col md:flex-row md:justify-between gap-1">
                  <h3 class="text-[10px] md:text-[11px] font-medium uppercase tracking-wider text-gray-900 truncate pr-2">
                    {{ product.name }}
                  </h3>
                  <p class="text-[10px] md:text-[11px] font-light text-gray-900">{{ product.price | currency }}</p>
                </div>
                <p class="text-[8px] md:text-[9px] text-gray-400 uppercase tracking-[0.2em]">{{ product.color }}</p>
              </div>
            </div>
          }
        </div>
      </main>

    </div>
  </div>

  <div *ngIf="isMobileFilterOpen"
       class="fixed inset-0 z-[100] bg-black/20 backdrop-blur-sm lg:hidden"
       (click)="toggleFilter()">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-8 space-y-8 transform transition-transform"
         (click)="$event.stopPropagation()">
      <div class="w-12 h-1 bg-gray-100 rounded-full mx-auto mb-4"></div>
      <h4 class="text-xs uppercase tracking-[0.3em] font-bold text-center">Filter By Category</h4>
      <div class="grid grid-cols-2 gap-3">
        @for (cat of categories; track cat) {
          <button (click)="toggleFilter()"
                  class="py-4 border border-gray-100 text-[10px] uppercase tracking-widest active:bg-black active:text-white transition-colors">
            {{ cat }}
          </button>
        }
      </div>
      <button (click)="toggleFilter()" class="w-full py-5 bg-black text-white text-[10px] uppercase tracking-[0.3em] font-bold">
        Show Results
      </button>
    </div>
  </div>

</div>
