<div class="fixed inset-0 bg-black/20 backdrop-blur-md z-[200] animate-fade-in"
     (click)="close()"
     *ngIf="isOpen">
</div>

<div [class.translate-x-0]="isOpen" [class.translate-x-full]="!isOpen"
     class="fixed top-0 right-0 h-full w-full max-w-[420px] bg-white z-[201] shadow-2xl transition-transform duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] flex flex-col overflow-hidden">

  <button (click)="close()" class="absolute top-10 right-10 p-2 hover:bg-gray-100 rounded-full transition-colors">
    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <div *ngIf="currentStep === 'identity'" class="mt-24 px-12 flex flex-col items-stretch animate-slide-in">
    <h2 class="text-[28px] font-light tracking-tight text-[#1a1a1a] mb-1 font-khmer-body">Identity</h2>
    <p class="text-[10px] text-gray-400 uppercase tracking-[0.4em] mb-16 font-medium">Superior Wardrobe</p>

    <div class="w-full border-b border-gray-100 py-3 mb-8 focus-within:border-black transition-colors duration-500">
      <label class="block text-[9px] uppercase tracking-[0.3em] text-gray-400 mb-2 font-bold">Mobile Number</label>
      <div class="flex items-center gap-3">
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"></path>
        </svg>
        <input type="tel" placeholder="+855 00 000 000" class="w-full bg-transparent text-sm focus:outline-none font-light tracking-[0.1em] text-[#1a1a1a]">
      </div>
    </div>

    <button (click)="currentStep = 'otp'" class="w-full bg-[#1a1a1a] text-white text-[10px] uppercase tracking-[0.4em] h-[52px] hover:bg-black transition-all">
      Continue
    </button>

    <div class="relative w-full my-12 text-center">
      <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-50"></div></div>
      <span class="relative px-6 bg-white text-[9px] text-gray-300 uppercase tracking-[0.5em] font-medium">Social Handshake</span>
    </div>

    <app-google-auth class="mb-4"></app-google-auth>
    <app-telegram-auth></app-telegram-auth>
  </div>

  <div *ngIf="currentStep === 'otp'" class="mt-24 px-12 flex flex-col items-stretch animate-slide-in">
    <button (click)="currentStep = 'identity'" class="flex items-center gap-2 mb-8 text-gray-400 hover:text-black group">
      <svg class="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      <span class="text-[9px] uppercase tracking-[0.2em] font-bold">Back</span>
    </button>

    <h2 class="text-[28px] font-light tracking-tight text-[#1a1a1a] mb-1 font-khmer-body">Verification</h2>
    <p class="text-[10px] text-gray-400 uppercase tracking-[0.4em] mb-12 font-medium">Enter 6-digit code</p>

    <div class="flex justify-between gap-2 mb-10" (paste)="onPaste($event)">
      <input #i1 type="text" maxlength="1" [(ngModel)]="v1" (input)="next($event, i2)" (keydown)="back($event)" class="otp-box">
      <input #i2 type="text" maxlength="1" [(ngModel)]="v2" (input)="next($event, i3)" (keydown)="back($event, i1)" class="otp-box">
      <input #i3 type="text" maxlength="1" [(ngModel)]="v3" (input)="next($event, i4)" (keydown)="back($event, i2)" class="otp-box">
      <input #i4 type="text" maxlength="1" [(ngModel)]="v4" (input)="next($event, i5)" (keydown)="back($event, i3)" class="otp-box">
      <input #i5 type="text" maxlength="1" [(ngModel)]="v5" (input)="next($event, i6)" (keydown)="back($event, i4)" class="otp-box">
      <input #i6 type="text" maxlength="1" [(ngModel)]="v6" (input)="next($event)" (keydown)="back($event, i5)" class="otp-box">
    </div>

    <button (click)="verifyOtp()" class="w-full bg-[#1a1a1a] text-white text-[10px] uppercase tracking-[0.4em] h-[52px] hover:bg-black transition-all">
      Verify Identity
    </button>
  </div>
</div>
